---
description: マークダウンレンダリングの要件定義
---
# マークダウンレンダリング

マークダウンをHTMLに変換し、mermaidダイアグラムとシンタックスハイライトに対応したプレビューを提供する。

関連: [design](design.md)

## EARS記法パターン

| パターン | 構文 | 用途 |
|---------|------|------|
| Event-Driven | When [イベント], the [システム] shall [アクション] | イベント発生時の動作 |
| State-Driven | While [状態], the [システム] shall [アクション] | 特定状態中の動作 |
| Unwanted | If [トリガー], the [システム] shall [アクション] | 異常系・エラー処理 |
| Optional | Where [機能], the [システム] shall [アクション] | オプション機能 |
| Ubiquitous | The [システム] shall [アクション] | 常に適用される動作 |

## 1. マークダウン変換

**目的**: ユーザーとして、マークダウンを見やすくレンダリングされた状態で確認したい。それにより、最終的な表示結果をプレビューできる。

### 受け入れ基準

1.1 The システムはマークダウンをHTMLに変換して表示するものとする

1.2 The システムはGitHub Flavored Markdown（テーブル、タスクリスト、絵文字）をサポートするものとする

1.3 The システムはGitHub風のスタイル（github-markdown-css）を適用するものとする

## 2. タスクリスト表示

**目的**: ユーザーとして、タスクリスト内の番号付きテキスト（例: `- [x] 1. プロジェクト初期設定`）を正確に表示してほしい。それにより、タスク管理ドキュメントを正しく閲覧できる。

### 受け入れ基準

2.1 When マークダウン `- [x] 1. テキスト` がレンダリングされた場合, the システムはチェック済みボックスの後に「1. テキスト」をプレーンテキストとして表示するものとする

2.2 When マークダウン `- [ ] 2. テキスト` がレンダリングされた場合, the システムは未チェックボックスの後に「2. テキスト」をプレーンテキストとして表示するものとする

2.3 The システムはタスクリスト内の番号付きテキストをネストした番号付きリスト（`<ol>`）として解釈しないものとする

2.4 The システムはタスクリスト内の番号をローマ数字（i, ii, iii...）に変換しないものとする

2.5 The システムは通常のタスクリスト（番号なし）の表示に影響を与えないものとする

2.6 When markedがルーズリスト処理により `<p>` タグでinput要素をラップした場合（例: `<p><input></p><ol><li>テキスト</li></ol>`）, the システムは `<p>` タグを除去し、チェックボックスの後にテキストをプレーンテキストとして表示するものとする

## 3. シンタックスハイライト

**目的**: ユーザーとして、コードブロックにシンタックスハイライトを適用してほしい。それにより、コードの可読性が向上する。

### 受け入れ基準

3.1 When コードブロックがレンダリングされた場合, the システムはhighlight.jsによるシンタックスハイライトを適用するものとする

3.2 When 言語指定付きコードブロック（例: ```typescript）がレンダリングされた場合, the システムは指定された言語のハイライトを適用するものとする

3.3 When 言語指定なしのコードブロックがレンダリングされた場合, the システムは自動検出によるハイライトを適用するものとする

3.4 The システムはダークテーマに適したシンタックスハイライトの色を使用するものとする

3.5 The システムはhighlight.jsのCSSテーマ（github-dark）を読み込み、ハイライト色を適用するものとする

3.6 The システムはcode要素にhljsクラスを付与し、highlight.jsのCSSが適用されるようにするものとする

## 4. Mermaidダイアグラム

**目的**: ユーザーとして、mermaidダイアグラムもダークテーマで表示したい。それにより、ダイアグラムの視認性が向上する。

### 受け入れ基準

4.1 The システムはmermaidコードブロックをダイアグラムとしてレンダリングするものとする

4.2 When mermaidコードブロックが含まれる場合, the システムはクライアントサイドでmermaid.jsを使用してダイアグラムを描画するものとする

4.3 When mermaidコードブロックがレンダリングされた場合, the システムはhighlight.jsによるハイライトを適用せず、mermaidダイアグラムとして処理するものとする

4.4 The システムは、mermaidのテーマを `'dark'` に設定するものとする

4.5 The システムは、mermaidコンテナの背景色に `var(--color-canvas-subtle)` を使用するものとする
